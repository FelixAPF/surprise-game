<div class="game-container">
  
  <div class="board-area" *ngIf="gs.gameState() === 'SETUP'">
    <header class="game-header">
      <h1>Welcome to the Game</h1>
      
      <div *ngIf="gs.prizes().length === 16; else notReady">
        <h2 style="color: #4caf50; margin-bottom: 2rem;">Ready to Play</h2>
        <button class="big-start-btn" (click)="gs.startGame()">START GAME</button>
      </div>

      <ng-template #notReady>
        <h2 style="color: #f44336;">Setup Incomplete</h2>
        <p>You need exactly 16 prizes to start. (Current: {{gs.prizes().length}})</p>
        <a routerLink="/admin" style="color: #2196f3; font-size: 1.2rem; cursor: pointer;">Go to Admin Panel</a>
      </ng-template>
    </header>
  </div>

  <div class="board-area" *ngIf="gs.gameState() !== 'SETUP'">
    <header class="game-header">
      <h1 *ngIf="gs.gameState() === 'PICK_OWN'">Choose YOUR Lucky Briefcase</h1>
      <h1 *ngIf="gs.gameState() === 'PLAYING'">
        Round {{gs.currentRoundIndex() + 1}}: Open {{remainingToOpen}} Briefcase(s)
      </h1>
      <h1 *ngIf="gs.gameState() === 'SWAP_ROUND'">Final Decision</h1>
      <h1 *ngIf="gs.gameState() === 'FINISHED'">Congratulations!</h1>
    </header>

    <div class="grid">
      <div *ngFor="let c of boardCases" 
           class="briefcase"
           [class.open]="c.isOpen"
           (click)="handleCaseClick(c)">
        <span *ngIf="!c.isOpen">{{c.id}}</span>
      </div>
    </div>

    <div class="held-section" *ngIf="heldCase">
      <h3>Your Case</h3>
      <div class="briefcase held" [class.open]="heldCase?.isOpen">
        <span>{{heldCase?.id}}</span>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <div *ngFor="let p of gs.sortedPrizes()" 
         class="prize-row" 
         [ngClass]="p.category"
         [class.eliminated]="p.isRevealed">
      <span class="prize-value">
        {{ p.isRevealed ? p.name : "?" }}
      </span>
    </div>
  </div>

</div>

<div class="overlay" *ngIf="zoomedCase" (click)="closeZoom()">
  
  <div class="zoom-card" 
       [class]="zoomedCase.prize.category"
       (click)="$event.stopPropagation()">
    
    <h2>Briefcase {{zoomedCase.id}} contained...</h2>
    <img [src]="zoomedCase.prize.imageUrl" alt="Prize Image" class="reveal-img">
    
    <div class="prize-info" [ngClass]="zoomedCase.prize.category">
      <h3>{{zoomedCase.prize.name}}</h3>
      <p style="font-size: 1.2rem; font-weight: normal;">{{zoomedCase.prize.category}}</p>
    </div>
    
    <p class="tap-hint">(Tap anywhere to close)</p>
  </div>
</div>

<div class="overlay" *ngIf="gs.gameState() === 'SWAP_ROUND'">
  <div class="swap-card">
    <h2>Final Round</h2>
    <p>You have one case left on the board.</p>
    <p>Do you want to keep your original case ({{heldCase?.id}}) or SWAP it?</p>
    <div class="actions">
      <button (click)="gs.keepCase()">KEEP CASE {{heldCase?.id}}</button>
      <button (click)="gs.swapCase()">SWAP CASE</button>
    </div>
  </div>
</div>

<div class="overlay" *ngIf="gs.gameState() === 'FINISHED' && heldCase?.isOpen">
  <canvas #winnerCanvas class="fireworks-canvas"></canvas>

  <div class="zoom-card winner" (click)="resetGame()">
    <h1 class="black">CONGRATULATIONS!</h1>
    <img [src]="heldCase!.prize.imageUrl" class="reveal-img large">
    <h2 class="black">You won:</h2>
    <h1 style="color: #d32f2f; font-size: 2.5rem;">{{heldCase!.prize.name}}</h1>
  </div>
</div>