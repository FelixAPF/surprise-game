<div class="game-container">
  
  <div class="board-area" id="main-board" *ngIf="gs.gameState() !== 'SETUP'">
    <header class="game-header">
      <h1 *ngIf="gs.gameState() === 'PICK_OWN'">Choisissez votre valise</h1>
      <h1 *ngIf="gs.gameState() === 'PLAYING'">
        Manche {{gs.currentRoundIndex() + 1}} <span style="color:#666; margin: 0 15px;">|</span> <span style="color:#e50914">Ouvrir {{remainingToOpen()}}</span>
      </h1>
      <h1 *ngIf="gs.gameState() === 'SWAP_ROUND'">Décision Finale</h1>
      <h1 *ngIf="gs.gameState() === 'FINISHED' && !isPlayingVideo()">Résumé</h1>
    </header>

    <div class="grid">
      <div *ngFor="let c of boardCases" 
           class="briefcase"
           [class.open]="c.isOpen"
           (click)="handleCaseClick(c)">
        <span>{{c.id}}</span>
      </div>
    </div>

    <div class="held-section" *ngIf="heldCase()">
      <h3>VOTRE VALISE</h3>
      <div class="briefcase held" [class.open]="heldCase()?.isOpen">
        <span>{{heldCase()?.id}}</span>
      </div>
    </div>
  </div>

  <div class="board-area" *ngIf="gs.gameState() === 'SETUP'">
    <header class="game-header" style="z-index: 100;">
      <h1 class="netflix-anim" style="font-size: 6rem; color: #e50914; margin-bottom: 10px;">SURPRISE GAME</h1>
      <p class="fade-in-delayed" style="font-size: 1.5rem; color: #999; letter-spacing: 5px; font-weight: 300;">UNE PRODUCTION ORIGINALE</p>
      
      <div class="fade-in-delayed" style="margin-top: 60px;">
        <div *ngIf="gs.prizes().length === 16; else notReady">
          <button class="big-start-btn" (click)="gs.startGame()">JOUER</button>
        </div>
        <ng-template #notReady>
          <div style="color: #666;">
            <p style="margin-bottom: 20px;">INITIALISATION DU SYSTÈME...</p>
            <a routerLink="/admin" style="color: #e50914; text-decoration: none; border: 1px solid #333; padding: 10px 20px; border-radius: 4px;">ACCÈS ADMIN</a>
          </div>
        </ng-template>
      </div>
    </header>
  </div>

  <div class="sidebar">
    <div style="margin-bottom: 20px; color: #666; font-size: 0.8rem; letter-spacing: 2px; font-weight: bold; text-align: right;">
      PRIX RESTANTS
    </div>
    <div *ngFor="let p of gs.sortedPrizes()" class="prize-row" [ngClass]="p.category" [class.eliminated]="p.isRevealed">
      <span class="prize-name" style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
        {{ p.name }}
      </span>
    </div>
  </div>

</div>

<div class="overlay" *ngIf="zoomedCase" (click)="closeZoom()">
  <div class="zoom-card" [class]="zoomedCase.prize.category" (click)="$event.stopPropagation()">
    <div class="card-content">
      <div style="font-size: 1rem; color: #888; letter-spacing: 4px; margin-bottom: 15px; font-weight: bold;">
        VALISE {{zoomedCase.id}}
      </div>
      <img [src]="zoomedCase.prize.imageUrl" class="reveal-img">
      <div class="prize-info">
        <h3>{{zoomedCase.prize.name}}</h3>
        <p class="prize-category">{{zoomedCase.prize.category}}</p>
      </div>
    </div>
  </div>
</div>

<div class="overlay" *ngIf="gs.gameState() === 'SWAP_ROUND'">
  <div class="swap-card">
    <h2>Il reste une valise</h2>
    <p style="color: #aaa; margin: 20px 0;">Voulez-vous échanger votre valise ?</p>
    <div class="actions">
      <button (click)="gs.keepCase()">GARDER {{heldCase()?.id}}</button>
      <button (click)="gs.swapCase()" style="background: #333; color: white;">ÉCHANGER</button>
    </div>
  </div>
</div>

<div class="overlay video-overlay" *ngIf="isPlayingVideo()">
  
  <video *ngIf="videoType() === 'GENERIC'"
         [src]="safeVideoUrl()" 
         autoplay 
         (ended)="onVideoEnded()"
         class="fullscreen-video">
  </video>

  <div *ngIf="videoType() === 'YOUTUBE'" class="youtube-wrapper">
    <div #ytPlayer></div>
  </div>

  <button class="skip-btn" (click)="onVideoEnded()">PASSER</button>
</div>

<div class="overlay" *ngIf="gs.gameState() === 'FINISHED' && !isPlayingVideo()">
  <canvas #winnerCanvas class="fireworks-canvas"></canvas>
  
  <div class="summary-board">
    
    <div class="winner-section">
      <h1 class="winner-title">FÉLICITATIONS</h1>
      <div class="zoom-card winner" [class]="heldCase()?.prize?.category">
        <div class="card-content">
          <img [src]="heldCase()?.prize?.imageUrl" class="reveal-img large">
          <h2>{{heldCase()?.prize?.name}}</h2>
          <p class="prize-category">{{heldCase()?.prize?.category}}</p>
        </div>
      </div>
      <button class="play-again-btn" (click)="resetGame()">REJOUER</button>
    </div>

    <div class="others-section">
      <h3>Les Autres Prix</h3>
      <div class="others-grid">
        <div *ngFor="let p of unwonPrizes()" class="mini-card" [ngClass]="p.category">
          <div class="mini-info">
            <span class="mini-name">{{p.name}}</span>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>